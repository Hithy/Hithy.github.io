---
layout: post
title:  "折腾NUC"
date:   2019-03-25 00:25:17 +0800
categories: tech
---

# 前言

从过年回来到现在，一直在寻找路由器的替代品，一台设备集成路由、防火墙和基础的私有云。因为现在还不稳定的原因，不能组一台高性能网关（没地方放），而且这种设备基本上是通宵开机，不能影响休息，所以噪音不能太大，所以带机械硬盘和大风扇的就不用考虑了。

现在用是本科留下来的极路由2，因为固件不多，只能将就官方的系统，不过换成openwrt源之后，也实现了一些扩展，包括ss和v2ray的非透明代理（通过端口访问）。作为路由器来说，功能已经满足需求了，但是受限与性能和百兆网口，无法实现更加高级的功能。

后来在坛子里面收了台NUC，正好赶上鱼竿厂SSD降价，搭了一个简单的私有云（nextcloud方案），勉强满足了现有的需求。但是NUC最大的遗憾是只有一个独立的网口（不要提那个什么骷髅，穷！）。

前段时间也在淘宝买了台ER-X，折腾了两天，算是解决了百兆网络的瓶颈。因为性能还是捉急，也没有物理的扩展性（非标准POE真的坑），做不了独立的网关。不过基于Debian的EdgeOS真的好用，而且最新版系统中用了systemd管理服务，在软件方面有很大的潜力，于是打算稳定用了。但天有不测风云，用了两天，路由器莫名挂了，reset都没用，变砖了？！只好联系卖家寄了回去。后来想想，这东西相对极路由来说，其实并没有本质的提升，作为网关还需要额外的设备（wifi，透明代理受限于内核不能用）。售后也墨迹，两周没给出实质性的回复，索性退货了。

后来又去看了下各种软路由、硬路由的评测，顺便总结了下需求：

1. 不占地方，ITX以上的就不考虑了
1. 噪音小
1. 性能不能太差
1. 有一定硬件扩展能力

回过头来看，才发现NUC真的不错：小巧、core i系列处理器、pcie m.2、7mm sata、自带无线网卡......近乎完美，然而，它只有一个网口。虽然也能配置成单臂路由，但是也需要额外的设备（交换机支持VLAN）。最后，只能折中一下，在usb口上插一张胡会长同款有线网卡。


# 开工

最初本想在BSD上面搭建，但是折腾一段时间后弃疗了，Linux真香！

1. 基础系统：ubuntu 18.04 x64 desktop
1. 网络设备管理：systemd-networkd
1. 防火墙：iptables
1. DNS+DHCP：dnsmasq
1. AP：hostapd
1. 动态域名：ddclient
1. web：apache2
1. 私有云：nextcloud
1. 媒体中心：emby
1. 远程下载：transmission-daemon
1. 代理：v2ray+shadowsocks-libev
1. 透明代理：iptables tproxy（待续）


# 未完待续



